<!DOCTYPE html><html><head><meta charSet="utf-8" class="next-head"/><meta http-equiv="X-UA-Compatible" content="IE=Edge" class="next-head"/><title class="next-head">Protect your DNS history with DNSCrypt ∴ wookiehangover.com</title><meta name="author" content="Samuel Breed" class="next-head"/><meta name="description" content="DNSCrypt is a great way to ensure that your browsing history isn&#x27;t being spyed on. Learn how to set up DNSCrypt to keep your DNS traffic from prying eyes." class="next-head"/><meta property="og:title" content="Protect your DNS history with DNSCrypt" class="next-head"/><meta property="og:type" content="website" class="next-head"/><meta property="og:image" content="https://wookiehangover.com/static/img/theodore-rex.jpg" class="next-head"/><meta property="og:description" content="DNSCrypt is a great way to ensure that your browsing history isn&#x27;t being spyed on. Learn how to set up DNSCrypt to keep your DNS traffic from prying eyes." class="next-head"/><meta name="viewport" content="width=device-width, initial-scale=1" class="next-head"/><link rel="stylesheet" href="/static/style.css" class="next-head"/><link rel="preload" href="/_next/6a093d96-cf6d-435b-bde0-9cfbee444ee7/page/writing/protect-your-history.html.js" as="script"/><link rel="preload" href="/_next/6a093d96-cf6d-435b-bde0-9cfbee444ee7/page/_app.js" as="script"/><link rel="preload" href="/_next/6a093d96-cf6d-435b-bde0-9cfbee444ee7/page/_error.js" as="script"/><link rel="preload" href="/_next/static/commons/main-ea029e078dade2cf5a8a.js" as="script"/><style id="__jsx-265517114">html,body{height:100%;min-height:100%;}
body{cursor:url(/static/img/avatar-sm.png) 10 10,auto;-webkit-font-smoothing:antialiased;}
li,p{font-feature-settings:"calt","liga","hist","onum","pnum";}
a:hover{cursor:url(/static/img/avatar-pointer.png) 10 10,auto;background-image:url("data:image/svg+xml;charset=utf8,%3Csvg id='Squiggle-svg' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' xmlns:ev='http://www.w3.org/2001/xml-events' viewBox='0 0 20 4'%3E%3Cstyle type='text/css'%3E.st0{animation:shift .3s linear infinite;}@keyframes shift {from {transform:translateX(0);}to {transform:translateX(-50%);}}%3C/style%3E%3Cpath fill='none' stroke='%23f00' stroke-width='1' class='st0' d='M0,3.5 c 5,0,5,-3,10,-3 s 5,3,10,3 c 5,0,5,-3,10,-3 s 5,3,10,3'/%3E%3C/svg%3E");background-position:0 100%;background-size:auto 3px;background-repeat:repeat-x;padding-bottom:3px;border-bottom-color:transparent;}</style></head><body><div id="__next"><div title="Protect your DNS history with DNSCrypt" description="DNSCrypt is a great way to ensure that your browsing history isn&#x27;t being spyed on. Learn how to set up DNSCrypt to keep your DNS traffic from prying eyes." class="jsx-265517114 times ma2 ma6-ns measure dark-gray"><main class="jsx-265517114 lh-copy f4 pb2"><header><h1 class="sans-serif lh-title fw3"><a class="dark-gray link bb" href="/">Samuel Breed</a> made this website.</h1></header><center>∴</center><section class="posts"><article class="mv4" id="protect-your-history.html"><div><h2 class="dark-gray code fw3">Protect your DNS history with DNSCrypt</h2>
<p class="lh-copy mv3">In light of the recent rollback(s) of regulations meant to restrict how ISP&#x27;s share and sell the data they gather about you, I started wondering what I could do to make my internet traffic a bit harder for them to monetize. How would I prevent my ISP from selling details about my shopping habits and personal preferences to the highest bidder?</p>
<p class="lh-copy mv3"><i><a class="dark-gray link bb hover-red" href="#first-steps">Or skip straight to how to do it.</a></i></p>
<h3 class="dark-gray code fw3">Why DNS and why should you care?</h3>
<p class="lh-copy mv3">Standards for encrypting web traffic have become widely adopted since their introduction in the late 90s. It&#x27;s not my first day, so I knew that content sent over HTTPS would be difficult (but not impossible) for a third party to do much with, and I already use HTTPS-everywhere and Brave to help keep things on the up-and-up. Unfortunately, even exclusively using HTTPS doesn&#x27;t mean that 100% of your traffic is encrypted and secure.</p>
<p class="lh-copy mv3">A crucially important part of how your computer or phone loads a website is completely unencrypted in practice. The Domain Name System, or DNS, is how your web browser knows how to find the domain &quot;google.com&quot; when you type <code class="f7 ">https://www.google.com</code> into your browser&#x27;s address bar, and DNS isn&#x27;t normally encrypted. Anyone who handles the traffic can take a peek if they&#x27;re so inclined.</p>
<blockquote class="f3 mv3 i mh0 pl3 bl lh-title b--rainbows">
<p class="lh-copy mv3">Ability plus incentive makes for easy temptation. DNS is an easy target if your ISP wanted to profit from a complete list of the websites you visited.</p>
</blockquote>
<p class="lh-copy mv3">Even worse, an ISP could resolve a DNS entry for a different website altogether or send you to a &quot;toll booth&quot; captive portal for whatever nefarious reasons they could think of.</p>
<p class="lh-copy mv3">Which means that even if I took every reasonable precaution and always made sure <code class="f7 ">https</code> was in the URL when buying John Tesh cd&#x27;s on Amazon, watching John Tesh videos on Youtube, or posting updates to my John Tesh fanzine, Comcast would still be able to see the URLs of the pages and sell them to anyone who cared. That is unacceptable. My secret love of John Tesh is too precious for a greedy corporate entity to harvest for profits.</p>
<a class="dark-gray link bb hover-red" href="../img/the-cyber.jpg">
  <img src="/static/img/the-cyber.jpg" class="w-60-l w-50-m w-100 ml3-ns fr-ns mt1 mb2 pa1 br1 ba b--rainbows"/>
</a>
<p class="lh-copy mv3">Good thing for me, a bunch of smart folks who are well versed in &quot;the cyber&quot; had already thought this one through enough to write RFC standards for the DNS protocol that can make it much harder for a third party to see the paper trail of domains and URLs left by a furious session of John Tesh related browsing. Even better, these standards have been implemented with open source and are available to use for free, without too much overhead.</p>
<p class="lh-copy mv3">Unfortunately, encrypting your DNS isn&#x27;t yet as ubiquitous or widely support as HTTPS, so there are still a few hoops to jump through if you want to start obfuscating this aspect of your web traffic.</p>
<p class="lh-copy mv3">It&#x27;s also important to note that encrypting your DNS isn&#x27;t a silver bullet with regards to online privacy. True privacy is a fleeting concept, or at least one that&#x27;s impossible to make sane guarantees about. Like any encryption technology, it&#x27;s only as strong as the implementation being used, and in recent years those have been known to be compromised with some degree of regularity. Even when you&#x27;re encrypting your communications doesn&#x27;t mean you should automatically trust the person on the other end of the line. Not to sound paranoid, but be careful about who you place blind trust in and always look before you leap.</p>
<h3 class="dark-gray code fw3">Enter DNSCrypt</h3>
<p class="lh-copy mv3">DNSCrypt is a great collection of software tools that let you get up and running with encrypted DNS really quickly. Don&#x27;t take my word of it. Head over to dnscrypt.org for comprehensive info about what it is and all the ways you can use it.</p>
<blockquote class="f3 mv3 i mh0 pl3 bl lh-title b--rainbows">
<p class="lh-copy mv3">dnscrypt + httpseverywhere is 9/10s of a vpn imo</p>
</blockquote>
<p class="lh-copy mv3 w-100 tr">
— <a class="dark-gray link bb hover-red" href="https://twitter.com/SlexAxton/status/853715217058025475">Alex Sexton, notable person on the internet</a>
</p>
<p class="lh-copy mv3">DNSCrypt is a way to run an encrypted dns server and clients for every platform to connect with it. There are already plenty of servers around the world that you can connect to out-of-the-box with a gui clients, so getting up and running is super easy. And there are plenty of command line tools, too. Everything is open source and the community seems active, with multiple projects to choose from for most layers of tooling.</p>
<p class="lh-copy mv3">The client apps work by changing your network settings to use a dns server running DNSCrypt, and lets you quickly switch back and forth between your previous &quot;normal&quot; dns and an encrypted configuration. It does this by running a local dns server on your computer, which handles one end of the encryption and decryption, with the public server you&#x27;re connecting with on the other end. Since all the traffic is encrypted on your computer before it&#x27;s sent to the server, an intermediary like your ISP can&#x27;t see the domain being requested.</p>
<h3 class="dark-gray code fw3">What&#x27;s the catch? Why isn&#x27;t this everywhere already?</h3>
<p class="lh-copy mv3">The catch is that ultimately your dns request will be served from an unencrypted (but authenticated) channel because the global network of DNS servers does not implement the DNSCrypt protocol.</p>
<p class="lh-copy mv3"><a class="dark-gray link bb hover-red" id="first-steps"></a></p>
<h3 class="dark-gray code fw3">First steps</h3>
<p class="lh-copy mv3">Better instructions here: <a class="dark-gray link bb hover-red" href="https://dnscrypt.org/">https://dnscrypt.org/</a></p>
<p class="lh-copy mv3">Install the <a class="dark-gray link bb hover-red" href="https://github.com/alterstep/dnscrypt-osxclient">dnscrypt-client</a> and connect to one of the public nodes. I chose <a class="dark-gray link bb hover-red" href="https://nxt.ist">https://nxt.ist</a>. You can &quot;trust&quot; these because they issue keypairs or something(?) but, caveat emptor.</p>
<p class="lh-copy mv3">But roll with the thick client because it&#x27;s convenient and you&#x27;ll get to see what you&#x27;re in for... which is pretty boring if you&#x27;re not running <code class="f7 ">dig</code> or <code class="f7 ">nslookup</code> all the time to see where your DNS entries are coming from. But then again, it&#x27;s pretty boring. But at least they&#x27;re encrypted?</p>
<h3 class="dark-gray code fw3">Paranoid mode: Roll your own DNSCrypt server</h3>
<p class="lh-copy mv3">I chose a droplet that came with Ubuntu 16.04 and Docker 1.17 pre-installed. Created a new keypair (always, always create a new keypair) and give it a good name, a static IPv4 address, and an IPv6 address if you hate yourself (or want to learn about docker&#x27;s nightmare factory networking layer).</p>
<p class="lh-copy mv3">SSH to the server and fire up the <a class="dark-gray link bb hover-red" href="https://github.com/jedisct1/dnscrypt-server-docker">DNSCrypt Server Docker Image</a> with the instructions from the README:</p>
<pre class="f7 ba br1 b--black-90 pre-code overflow-x-scroll"><code class="f7  hljs language-bash">docker run --name=dnscrypt-server -p 443:443/udp -p 443:443/tcp \
    jedisct1/unbound-dnscrypt-server init -N example.com

docker start dnscrypt</code></pre>
<p class="lh-copy mv3">The first command returns a public key. You&#x27;ll need this. It&#x27;s also in your docker logs if you forget it <code class="f7 ">docker logs dnscrypt-server | head</code>.</p>
<p class="lh-copy mv3">Now you have a server running, note the IP and setup a client to connect to it.</p>
<h3 class="dark-gray code fw3">Connecting clients with dnscrypt-proxy</h3>
<p class="lh-copy mv3">I tried 2 ways of connecting devices to my new dnscrypt server from my local network.</p>
<p class="lh-copy mv3"><b>1 - Run the proxy client everywhere</b></p>
<p class="lh-copy mv3">Run dnscrypt-proxy on every device where you want encrypted dns, which makes a local dns server which sends encrypted requests to your server. This is the &quot;safest&quot; way of doing things because you&#x27;re not trusting anyone else to do the encryption for you, making it a bit more difficult for someone to spy on your dns traffic.</p>
<p class="lh-copy mv3">Install it for mac with homebrew: <code class="f7 ">brew install dnscrypt-proxy</code></p>
<p class="lh-copy mv3">Then connect to your server using the IP and public key:</p>
<pre class="f7 ba br1 b--black-90 pre-code overflow-x-scroll"><code class="f7  hljs language-bash">sudo dnscrypt-proxy --provider-key=YOUR_PUBLIC_KEY \
  --resolver-address=YOUR_IPv4_ADDRESS:443 \
  --provider-name=2.dnscrypt-cert.example.com</code></pre>
<p class="lh-copy mv3">Now edit your DNS settings to point at your IP. This is actually really convenient if you&#x27;re already using dnscrypt-client: in the &quot;Advanced&quot; tab, add your IP to the field labeled &quot;When not using DNSCrypt, use the following static DNS servers&quot;. Now, when you turn off the DNSCrypt thick client, it will try to use the proxy you started from the command line.</p>
<p class="lh-copy mv3">It&#x27;s a pain in the ass that you can&#x27;t point to your own server on the client. There, I said it. Pull requests welcome, I guess?</p>
<p class="lh-copy mv3"><b>2 - Run it from one place on your local network</b></p>
<p class="lh-copy mv3">Run dnscrypt-proxy somewhere on your local network, and tell devices to use that as their source of truth for dns. If you trust your local network (which, depending on how many IOT devices you have running or you don&#x27;t control router/modem settings, might not be a good idea,) then you can avoid extra process overhead and it works for phones and tablets.</p>
<p class="lh-copy mv3">Basically the same steps as above, but make sure that you start the dnscrypt-proxy client with <code class="f7 ">--local-address=0.0.0.0</code> so that it broadcasts to your network.</p>
<p class="lh-copy mv3">And, uh, make sure your router doesn&#x27;t liberally port forward or you&#x27;ll live to regret it.</p>
<p class="lh-copy mv3">I did this on my ubuntu media server and I ran into dnsmasq issues, because ubuntu is stupid and runs a dnsmasq process as part of it&#x27;s network stack, but it&#x27;s not the &quot;real&quot; dnsmasq so you can&#x27;t configure it to broadcast (go figure).</p>
<p class="lh-copy mv3">To get everything working without just nuking the unconfigurable dnsmasq process, I had to run dnscrypt-proxy on another port, <code class="f7 ">127.0.0.1:40</code> and then install the &quot;real&quot; dnsmasq, <code class="f7 ">sudo apt-get install dnsmasq</code> and tell it to use dnscrypt-proxy as a nameserver. All this is from here, conveniently: <a class="dark-gray link bb hover-red" href="https://wiki.debian.org/HowTo/dnsmasq">https://wiki.debian.org/HowTo/dnsmasq</a></p>
<pre class="f7 ba br1 b--black-90 pre-code overflow-x-scroll"><code class="f7  hljs language-ini">no-resolv
server 127.0.0.1</code></pre>
<p class="lh-copy mv3">Then I switched all the dns settings on my phones and computers to point at the local ip of my media server for DNS, falling back to google&#x27;s <code class="f7 ">8.8.8.8</code> and <code class="f7 ">8.8.4.4</code> to avoid being inconveninced if the process dies.</p>
<h3 class="dark-gray code fw3">Conclusion</h3>
<div class="fr-ns w-50-ns w-100 ml3-ns tc tl-ns bonzi-buddy">
  <a class="none" href="https://en.wikipedia.org/wiki/BonziBuddy" target="__blank">
    <img src="/static../img/bonzi-buddy.gif" class="pa1"/>
  </a>
</div>
<p class="lh-copy mv3">Encrypting DNS is boring, but satisfying.</p>
<p class="lh-copy mv3">Happy Hacking 🤓</p>
<div class="cf"></div></div><footer class="code mt4 f6 mid-gray pa1 bg-near-white"><time>Mon May 28 14:56:22 2018 -0700</time><nav class="mv2 mv0-ns fr-ns"><a class="dark-gray link bb mr1" href="/writing/protect-your-history.html">Link</a><a class="dark-gray link bb mr1" href="https://github.com/wookiehangover/wookiehangover.com/edit/master/pages/writing/protect-your-history.html.js">Edit</a><a class="dark-gray link bb mr1" href="https://github.com/wookiehangover/wookiehangover.com/commits/master/pages/writing/protect-your-history.html.js">History</a></nav></footer></article></section></main><footer class="jsx-265517114 code measure mt5 bg-light-pink pv4 ph5 br1 shadow-5"><center class="jsx-265517114 white b f3">∴</center><p class="jsx-265517114 tc mv4 lh-copy"><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/" class="jsx-265517114 dark-gray link bb hover-red">creative commons</a> × <a title="View the source code of this website on Github" href="https://github.com/wookiehangover/wookiehangover.com" class="jsx-265517114 dark-gray link bb hover-red">open source</a>, <br class="jsx-265517114"/> so be kind rewind</p><nav class="jsx-265517114 flex justify-around"><div class="jsx-265517114"><a href="https://twitter.com/sambreed" title="Follow me on Twitter" class="jsx-265517114 dark-gray link bb hover-red">guestbook</a></div><div class="jsx-265517114"><a href="https://github.com/wookiehangover/wookiehangover.com/issues/new" title="Complaints" class="jsx-265517114 dark-gray link bb hover-red">complaints</a></div><div class="jsx-265517114"><a href="mailto:sam@destroy.email" title="Send me an Email" class="jsx-265517114 dark-gray link bb hover-red">suggestions</a></div></nav></footer></div></div><div id="__next-error"></div><script>
          __NEXT_DATA__ = {"props":{"pageProps":{}},"page":"/writing/protect-your-history.html","pathname":"/writing/protect-your-history.html","query":{},"buildId":"6a093d96-cf6d-435b-bde0-9cfbee444ee7","assetPrefix":"","nextExport":true,"err":null,"chunks":[]}
          module={}
          __NEXT_LOADED_PAGES__ = []
          __NEXT_LOADED_CHUNKS__ = []

          __NEXT_REGISTER_PAGE = function (route, fn) {
            __NEXT_LOADED_PAGES__.push({ route: route, fn: fn })
          }

          __NEXT_REGISTER_CHUNK = function (chunkName, fn) {
            __NEXT_LOADED_CHUNKS__.push({ chunkName: chunkName, fn: fn })
          }

          false
        </script><script async="" id="__NEXT_PAGE__/writing/protect-your-history.html" src="/_next/6a093d96-cf6d-435b-bde0-9cfbee444ee7/page/writing/protect-your-history.html.js"></script><script async="" id="__NEXT_PAGE__/_app" src="/_next/6a093d96-cf6d-435b-bde0-9cfbee444ee7/page/_app.js"></script><script async="" id="__NEXT_PAGE__/_error" src="/_next/6a093d96-cf6d-435b-bde0-9cfbee444ee7/page/_error.js"></script><script src="/_next/static/commons/main-ea029e078dade2cf5a8a.js" async=""></script></body></html>