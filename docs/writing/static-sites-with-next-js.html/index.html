<!DOCTYPE html><html><head><link rel="preload" href="/_next/a31abcd8-316b-4d11-bde8-4d0933ce0896/page/writing/static-sites-with-next-js.html/index.js" as="script"/><link rel="preload" href="/_next/a31abcd8-316b-4d11-bde8-4d0933ce0896/page/_error/index.js" as="script"/><link rel="preload" href="/_next/0099da6d259b9c7a1bd07664c3e5dd6e/app.js" as="script"/><meta charset="utf-8" class="next-head"/><meta class="next-head"/><meta content="IE=Edge" class="next-head"/><title class="next-head">How to Make a Static Blog with Next.js 3 ‚à¥ wookiehangover.com</title><meta name="author" content="Samuel Breed" class="next-head"/><meta name="description" content="I recently used Next.js 3 to make a static blog. Learn how I did it!" class="next-head"/><meta property="og:title" content="How to Make a Static Blog with Next.js 3" class="next-head"/><meta property="og:type" content="website" class="next-head"/><meta property="og:image" content="https://wookiehangover.com/static/img/theodore-rex.jpg" class="next-head"/><meta property="og:description" content="I recently used Next.js 3 to make a static blog. Learn how I did it!" class="next-head"/><meta name="viewport" content="width=device-width, initial-scale=1" class="next-head"/><link rel="stylesheet" href="/static/style.css" class="next-head"/></head><body><div><div id="__next"><div data-reactroot="" data-reactid="1" data-react-checksum="1568403867"><div data-reactid="2"><!-- react-empty: 3 --><main class="mw7 pa3 pa4-ns center min-vh-100" data-reactid="4"><header data-reactid="5"><a href="/" data-reactid="6">Back</a><h1 class="fw2" data-reactid="7"><a href="/" data-reactid="8">Samuel Breed</a><!-- react-text: 9 --> made this website.<!-- /react-text --></h1></header><section class="posts pb4" data-reactid="10"><article class="f5 mv4" id="static-sites-with-next-js" data-reactid="11"><div data-reactid="12"><h1 data-reactid="13"><!-- react-text: 14 -->How to Make a Static Blog with Next.js 3<!-- /react-text --></h1><!-- react-text: 15 -->
<!-- /react-text --><p class="lh-copy mv3" data-reactid="16"><img src="/static/img/next-blog-1.gif" alt="make a static next.js blog" data-reactid="17"/></p><!-- react-text: 18 -->
<!-- /react-text --><p class="lh-copy mv3" data-reactid="19"><!-- react-text: 20 -->üëã  Hey, so I recently finished upgrading this very website. No longer is my corner of  of the internet a  cobbled-together mess of node and of shell scripts. Now it&#x27;s a fully-fledged modern JavaScript app with <!-- /react-text --><a href="https://github.com/zeit/next.js" data-reactid="21"><!-- react-text: 22 -->Next.js 3<!-- /react-text --></a><!-- react-text: 23 -->!<!-- /react-text --></p><!-- react-text: 24 -->
<!-- /react-text --><p class="lh-copy mv3" data-reactid="25"><!-- react-text: 26 -->I can write and edit posts in Markdown and can even drop in custom HTML if I need to (I mean how else am I gonna incorporate <!-- /react-text --><code class="f7 " data-reactid="27"><!-- react-text: 28 -->&lt;marquee&gt;<!-- /react-text --></code><!-- react-text: 29 --> tags into my writing?). With <!-- /react-text --><a href="https://github.com/zeit/next.js" data-reactid="30"><!-- react-text: 31 -->Next.js<!-- /react-text --></a><!-- react-text: 32 -->, I get all sorts of fancy features. Service worker prefetch, code splitting, and SPA style route changes, all for free. <!-- /react-text --><em data-reactid="33"><!-- react-text: 34 -->Here&#x27;s how I did it.<!-- /react-text --></em></p><!-- react-text: 35 -->
<!-- /react-text --><p class="lh-copy mv3" data-reactid="36"><a href="https://zeit.co/blog/next3" data-reactid="37"><!-- react-text: 38 -->If you haven&#x27;t heard of Next.js it&#x27;s a pretty cool, live reloading, totally-out-of-your-way tool for building webapps with React. You should use it.<!-- /react-text --></a></p><!-- react-text: 39 -->
<!-- /react-text --><p class="lh-copy mv3" data-reactid="40"><!-- react-text: 41 -->As soon as the Zeit team announced plans to support serverless static exports, I was ready to go. I had already tried out Next.js for a few side projects, but didn&#x27;t want to worry about running a server (even if it&#x27;s free and painless) to keep my website up. I even tried scraping a compiled Next.js app with <!-- /react-text --><code class="f7 " data-reactid="42"><!-- react-text: 43 -->wget<!-- /react-text --></code><!-- react-text: 44 --> to make a static site, so Next&#x27;s official support for static sites had me running out of excuses.<!-- /react-text --></p><!-- react-text: 45 -->
<!-- /react-text --><p class="lh-copy mv3" data-reactid="46"><!-- react-text: 47 -->Here were my requirements for this humble website:<!-- /react-text --></p><!-- react-text: 48 -->
<!-- /react-text --><ul data-reactid="49"><!-- react-text: 50 -->
<!-- /react-text --><li class="mv1 lh-copy" data-reactid="51"><!-- react-text: 52 -->Fully static and deployable on Github pages.<!-- /react-text --></li><!-- react-text: 53 -->
<!-- /react-text --><li class="mv1 lh-copy" data-reactid="54"><!-- react-text: 55 -->Author posts in Markdown, with support for HTML things like <!-- /react-text --><code class="f7 " data-reactid="56"><!-- react-text: 57 -->&lt;details&gt;<!-- /react-text --></code><!-- react-text: 58 --> tags.<!-- /react-text --></li><!-- react-text: 59 -->
<!-- /react-text --><li class="mv1 lh-copy" data-reactid="60"><em data-reactid="61"><!-- react-text: 62 -->Fast.<!-- /react-text --></em><!-- react-text: 63 --> Nobody&#x27;s got time for slow websites.<!-- /react-text --></li><!-- react-text: 64 -->
<!-- /react-text --><li class="mv1 lh-copy" data-reactid="65"><!-- react-text: 66 -->Support my CSS preferences: <!-- /react-text --><a href="http://tachyons.io/" data-reactid="67"><!-- react-text: 68 -->Tachyons<!-- /react-text --></a><!-- react-text: 69 --> and some custom CSS compiled with <!-- /react-text --><a href="http://postcss.org/" data-reactid="70"><!-- react-text: 71 -->postcss<!-- /react-text --></a></li><!-- react-text: 72 -->
<!-- /react-text --></ul><!-- react-text: 73 -->
<!-- /react-text --><p class="lh-copy mv3" data-reactid="74"><!-- react-text: 75 -->Next.js seems to have checked off all my boxes, so I dug in and started prototyping.<!-- /react-text --></p><!-- react-text: 76 -->
<!-- /react-text --><blockquote class="f3 mv3 i mh0 pl3 bl lh-title b--rainbows" data-reactid="77"><!-- react-text: 78 -->
<!-- /react-text --><p class="lh-copy mv3" data-reactid="79"><!-- react-text: 80 -->&quot;Plan to throw one away; you will, anyhow&quot;.<!-- /react-text --></p><!-- react-text: 81 -->
<!-- /react-text --></blockquote><!-- react-text: 82 -->
<!-- /react-text --><div class="tr" data-reactid="83"><span class="measure dib" data-reactid="84"><!-- react-text: 85 -->
‚Äî <!-- /react-text --><i data-reactid="86"><!-- react-text: 87 -->The Mythical Man-Month<!-- /react-text --></i><!-- react-text: 88 -->, Fred Brooks (as popularized in <!-- /react-text --><i data-reactid="89"><!-- react-text: 90 -->The Cathedral and the Bazaar<!-- /react-text --></i><!-- react-text: 91 --> by Eric Raymond)
<!-- /react-text --></span></div><!-- react-text: 92 -->
<!-- /react-text --><p class="lh-copy mv3" data-reactid="93"><a href="https://github.com/wookiehangover/wookie-next" data-reactid="94"><!-- react-text: 95 -->I built a prototype on the Next.js 3 beta<!-- /react-text --></a><!-- react-text: 96 --> to kick the tires. I learned a few things along the way but didn&#x27;t end up with a website that was ready to deploy.<!-- /react-text --></p><!-- react-text: 97 -->
<!-- /react-text --><p class="lh-copy mv3" data-reactid="98"><!-- react-text: 99 -->Too bad I wasn&#x27;t very happy with my first pass. I added a necessary-but-clunky build step to convert my old posts to Next&#x27;s routing model. The plan was to compile my markdown posts and write out files to the <!-- /react-text --><code class="f7 " data-reactid="100"><!-- react-text: 101 -->pages/<!-- /react-text --></code><!-- react-text: 102 --> directory. Next.js would pick them up whenever they changed, but I didn&#x27;t like having to run two build scripts.<!-- /react-text --></p><!-- react-text: 103 -->
<!-- /react-text --><p class="lh-copy mv3" data-reactid="104"><em data-reactid="105"><!-- react-text: 106 -->Next&#x27;s biggest selling point is having live reloading figured out already!<!-- /react-text --></em><!-- react-text: 107 --> Having to run more than one script felt wrong, so I abandoned the prototype.<!-- /react-text --></p><!-- react-text: 108 -->
<!-- /react-text --><details class="pa4 ba b--rainbows mv4" data-reactid="109"><!-- react-text: 110 -->
<!-- /react-text --><summary data-reactid="111"><!-- react-text: 112 -->
  <!-- /react-text --><i data-reactid="113"><!-- react-text: 114 -->A brief aside re: a nifty markdown rendering pipeline with Unified and Remark that should probably be in it&#x27;s own post, but laziness.<!-- /react-text --></i><!-- react-text: 115 -->
<!-- /react-text --></summary><!-- react-text: 116 -->
<!-- /react-text --><blockquote class="f3 mv3 i mh0 pl3 bl lh-title b--rainbows" data-reactid="117"><!-- react-text: 118 -->
<!-- /react-text --><p class="lh-copy mv3" data-reactid="119"><!-- react-text: 120 -->Every good work of software starts by scratching a developer&#x27;s personal itch.<!-- /react-text --></p><!-- react-text: 121 -->
<!-- /react-text --></blockquote><!-- react-text: 122 -->
<!-- /react-text --><div class="tr" data-reactid="123"><span class="measure dib" data-reactid="124"><!-- react-text: 125 -->
‚Äî <!-- /react-text --><i data-reactid="126"><!-- react-text: 127 -->The Cathedral and the Bazaar<!-- /react-text --></i><!-- react-text: 128 -->, Eric Raymond
<!-- /react-text --></span></div><!-- react-text: 129 -->
<!-- /react-text --><h3 data-reactid="130"><!-- react-text: 131 -->üê∞ Rabbit Hole: React from HTML Markdown<!-- /react-text --></h3><!-- react-text: 132 -->
<!-- /react-text --><p class="lh-copy mv3" data-reactid="133"><!-- react-text: 134 -->One of the itches I <!-- /react-text --><em data-reactid="135"><!-- react-text: 136 -->really<!-- /react-text --></em><!-- react-text: 137 --> wanted to scratch was the minor annoyance of having to use <!-- /react-text --><code class="f7 " data-reactid="138"><!-- react-text: 139 -->__dangerouslySetInnerHtml<!-- /react-text --></code><!-- react-text: 140 --> to use most off-the-shelf markdown libraries with React. I even made it a bit harder on myself by lazily abusing markdown and sprikling bits of markup in many of my posts, since most React components that render markdown tend to fall back to to <!-- /react-text --><em data-reactid="141"><!-- react-text: 142 -->dangerouslySet<!-- /react-text --></em><!-- react-text: 143 --> instead of parsing the markdown to generate a valid React component for the entire markdown document. This isn&#x27;t a new or unsolved problem, so I did some research and ended up geeking out on text processing and abstract syntax trees. Turns out that there are already a bunch of well documented AST parser/compilers that support markdown on npm!<!-- /react-text --></p><!-- react-text: 144 -->
<!-- /react-text --><p class="lh-copy mv3" data-reactid="145"><!-- react-text: 146 -->I really didn&#x27;t want to make clients do any of the parsing work. Even though parsing markdown can be optimized to be fast in modern browsers, making users download additional JavaScript and spend CPU time to convert posts clientside just didn&#x27;t sit well with me.<!-- /react-text --></p><!-- react-text: 147 -->
<!-- /react-text --><p class="lh-copy mv3" data-reactid="148"><!-- react-text: 149 -->I decided that in order to handle all of my posts with their mix of markdown and html, I would use <!-- /react-text --><a href="https://unifiedjs.github.io/" data-reactid="150"><!-- react-text: 151 -->Unified<!-- /react-text --></a><!-- react-text: 152 --> to make a rendering pipeline to go from markdown to HTML to a set of React components. There were already unified plugins for everything I wanted to do!<!-- /react-text --></p><!-- react-text: 153 -->
<!-- /react-text --><p class="lh-copy mv3" data-reactid="154"><!-- react-text: 155 -->There was even a <!-- /react-text --><a href="https://github.com/mapbox/remark-react" data-reactid="156"><!-- react-text: 157 -->ready-made solution for my exact gripe about <!-- /react-text --><code class="f7 " data-reactid="158"><!-- react-text: 159 -->__dangerouslySetInnerHtml<!-- /react-text --></code></a><!-- react-text: 160 -->! Unfortunately, remark-react handles <!-- /react-text --><em data-reactid="161"><!-- react-text: 162 -->most<!-- /react-text --></em><!-- react-text: 163 --> cases but didn&#x27;t want to parse the raw HTMl generously sprinkled throughout my posts. Either way, I had found a small ecosystem of node modules that would make short work of lots of text processing problems. Neat!<!-- /react-text --></p><!-- react-text: 164 -->
<!-- /react-text --><p class="lh-copy mv3" data-reactid="165"><!-- react-text: 166 -->Here&#x27;s what the code ended up looking like:<!-- /react-text --></p><!-- react-text: 167 -->
<!-- /react-text --><pre class="f7 ba br1 b--black-90 pre-code overflow-x-scroll" data-reactid="168"><code class="f7  hljs language-js" data-reactid="169"><span class="hljs-keyword" data-reactid="170"><!-- react-text: 171 -->const<!-- /react-text --></span><!-- react-text: 172 --> unified = <!-- /react-text --><span class="hljs-built_in" data-reactid="173"><!-- react-text: 174 -->require<!-- /react-text --></span><!-- react-text: 175 -->(<!-- /react-text --><span class="hljs-string" data-reactid="176"><!-- react-text: 177 -->&#x27;unified&#x27;<!-- /react-text --></span><!-- react-text: 178 -->)

unified()
  .use(<!-- /react-text --><span class="hljs-built_in" data-reactid="179"><!-- react-text: 180 -->require<!-- /react-text --></span><!-- react-text: 181 -->(<!-- /react-text --><span class="hljs-string" data-reactid="182"><!-- react-text: 183 -->&#x27;remark-parse&#x27;<!-- /react-text --></span><!-- react-text: 184 -->), {
    <!-- /react-text --><span class="hljs-attr" data-reactid="185"><!-- react-text: 186 -->gfm<!-- /react-text --></span><!-- react-text: 187 -->: <!-- /react-text --><span class="hljs-literal" data-reactid="188"><!-- react-text: 189 -->true<!-- /react-text --></span><!-- react-text: 190 -->,
    <!-- /react-text --><span class="hljs-attr" data-reactid="191"><!-- react-text: 192 -->footnotes<!-- /react-text --></span><!-- react-text: 193 -->: <!-- /react-text --><span class="hljs-literal" data-reactid="194"><!-- react-text: 195 -->true<!-- /react-text --></span><!-- react-text: 196 -->
  })
  .use(<!-- /react-text --><span class="hljs-built_in" data-reactid="197"><!-- react-text: 198 -->require<!-- /react-text --></span><!-- react-text: 199 -->(<!-- /react-text --><span class="hljs-string" data-reactid="200"><!-- react-text: 201 -->&#x27;remark-rehype&#x27;<!-- /react-text --></span><!-- react-text: 202 -->), {
    <!-- /react-text --><span class="hljs-attr" data-reactid="203"><!-- react-text: 204 -->allowDangerousHTML<!-- /react-text --></span><!-- react-text: 205 -->: <!-- /react-text --><span class="hljs-literal" data-reactid="206"><!-- react-text: 207 -->true<!-- /react-text --></span><!-- react-text: 208 -->
  })
  .use(<!-- /react-text --><span class="hljs-built_in" data-reactid="209"><!-- react-text: 210 -->require<!-- /react-text --></span><!-- react-text: 211 -->(<!-- /react-text --><span class="hljs-string" data-reactid="212"><!-- react-text: 213 -->&#x27;rehype-raw&#x27;<!-- /react-text --></span><!-- react-text: 214 -->))
  .use(<!-- /react-text --><span class="hljs-built_in" data-reactid="215"><!-- react-text: 216 -->require<!-- /react-text --></span><!-- react-text: 217 -->(<!-- /react-text --><span class="hljs-string" data-reactid="218"><!-- react-text: 219 -->&#x27;rehype-react&#x27;<!-- /react-text --></span><!-- react-text: 220 -->))<!-- /react-text --></code></pre><!-- react-text: 221 -->
<!-- /react-text --><p class="lh-copy mv3" data-reactid="222"><!-- react-text: 223 -->To my suprise and delight, that process pipeline resulted in a totally usable React component! But it still would require some redundant processing on the client since the React component was being generated dynamicaly from a string of markdown. <!-- /react-text --></p><!-- react-text: 224 -->
<!-- /react-text --><p class="lh-copy mv3" data-reactid="225"><!-- react-text: 226 -->So how do you <!-- /react-text --><em data-reactid="227"><!-- react-text: 228 -->cache<!-- /react-text --></em><!-- react-text: 229 --> a React component? Like, a whole component, not just the serialization of it&#x27;s virtual dom. React provides tools to server render components in multiple ways, but you can&#x27;t easily generate <!-- /react-text --><em data-reactid="230"><!-- react-text: 231 -->jsx<!-- /react-text --></em><!-- react-text: 232 --> from a dynamically generated components. But there <!-- /react-text --><em data-reactid="233"><!-- react-text: 234 -->is<!-- /react-text --></em><!-- react-text: 235 --> a techinique for dealing with a React as a compile output of an AST, evidenced by <!-- /react-text --><a href="https://github.com/rhysd/rehype-react" data-reactid="236"><!-- react-text: 237 -->react-rehype<!-- /react-text --></a><!-- react-text: 238 --> at the end of that Unified markdown pipeline.<!-- /react-text --></p><!-- react-text: 239 -->
<!-- /react-text --><p class="lh-copy mv3" data-reactid="240"><!-- react-text: 241 -->React has a dead simple API for creating components without JSX in <!-- /react-text --><code class="f7 " data-reactid="242"><!-- react-text: 243 -->React.createElement()<!-- /react-text --></code><!-- react-text: 244 -->. Since it&#x27;s just plain JavaScript and doesn&#x27;t require any functions or non-serializable data structures, it turns out that you can make a JSON structure that represents a set of React components pretty easily. I had run into a use case for this same trick at work, so I put it to use again here: I modified the last step of my Unified pipeline to return JSON instead of a React component. <!-- /react-text --><a href="https://github.com/rhysd/rehype-react" data-reactid="245"><code class="f7 " data-reactid="246"><!-- react-text: 247 -->rehype-react<!-- /react-text --></code></a><!-- react-text: 248 --> made this a cinch, since they allow you to pass a custom method for <!-- /react-text --><code class="f7 " data-reactid="249"><!-- react-text: 250 -->createElement<!-- /react-text --></code><!-- react-text: 251 -->.<!-- /react-text --></p><!-- react-text: 252 -->
<!-- /react-text --><pre class="f7 ba br1 b--black-90 pre-code overflow-x-scroll" data-reactid="253"><code class="f7  hljs language-js" data-reactid="254"><!-- react-text: 255 -->remarkPipeline().use(rehypeReact, {
  <!-- /react-text --><span class="hljs-attr" data-reactid="256"><!-- react-text: 257 -->createElement<!-- /react-text --></span><!-- react-text: 258 -->: <!-- /react-text --><span class="hljs-function" data-reactid="259"><!-- react-text: 260 -->(<!-- /react-text --><span class="hljs-params" data-reactid="261"><!-- react-text: 262 -->type, props, children<!-- /react-text --></span><!-- react-text: 263 -->) =&gt;<!-- /react-text --></span><!-- react-text: 264 --> ({ type, props, children })
})<!-- /react-text --></code></pre><!-- react-text: 265 -->
<!-- /react-text --><p class="lh-copy mv3" data-reactid="266"><!-- react-text: 267 -->From there, I made a <!-- /react-text --><a href="https://github.com/wookiehangover/wookiehangover.com/blob/master/src/components/component-tree.js" data-reactid="268"><!-- react-text: 269 -->simple component<!-- /react-text --></a><!-- react-text: 270 --> to transform the result from <!-- /react-text --><a href="https://github.com/rhysd/rehype-react" data-reactid="271"><code class="f7 " data-reactid="272"><!-- react-text: 273 -->rehype-react<!-- /react-text --></code></a><!-- react-text: 274 --> back into a React component:<!-- /react-text --></p><!-- react-text: 275 -->
<!-- /react-text --><pre class="f7 ba br1 b--black-90 pre-code overflow-x-scroll" data-reactid="276"><code class="f7  hljs language-jsx" data-reactid="277"><!-- react-text: 278 -->&lt;ComponentTree components={components} /&gt;<!-- /react-text --></code></pre><!-- react-text: 279 -->
<!-- /react-text --><p class="lh-copy mv3" data-reactid="280"><!-- react-text: 281 -->Now I have an pipeline where you can put markdown with crazy embedded HTML in one end, and well-formed <!-- /react-text --><em data-reactid="282"><!-- react-text: 283 -->serializable<!-- /react-text --></em><!-- react-text: 284 --> React components come out of the other end. With that, I can write out JavaScript files containing valid React components without having to reconstruct any JSX literals from the rehype AST. Either way that&#x27;s a step that I wanted to be transparent when I was writing posts. Mission accomplished üòé<!-- /react-text --></p><!-- react-text: 285 -->
<!-- /react-text --><p class="lh-copy mv3" data-reactid="286"><!-- react-text: 287 -->There are a couple of benefits from going through all that trouble:<!-- /react-text --></p><!-- react-text: 288 -->
<!-- /react-text --><ul data-reactid="289"><!-- react-text: 290 -->
<!-- /react-text --><li class="mv1 lh-copy" data-reactid="291"><a href="https://github.com/wooorm/remark/blob/master/doc/plugins.md" data-reactid="292"><!-- react-text: 293 -->remark plugins<!-- /react-text --></a><!-- react-text: 294 --> can do just about anything. Seriously. I was able to add code highlighting <!-- /react-text --><em data-reactid="295"><!-- react-text: 296 -->while I was writing this post<!-- /react-text --></em><!-- react-text: 297 --> with 1 npm install, 1 line of JavaScript, and 1 line of CSS!<!-- /react-text --></li><!-- react-text: 298 -->
<!-- /react-text --><li class="mv1 lh-copy" data-reactid="299"><!-- react-text: 300 -->Unified&#x27;s <!-- /react-text --><a href="https://github.com/vfile/vfile" data-reactid="301"><!-- react-text: 302 -->vfile<!-- /react-text --></a><!-- react-text: 303 --> format makes adding post metadata easy.<!-- /react-text --></li><!-- react-text: 304 -->
<!-- /react-text --><li class="mv1 lh-copy" data-reactid="305"><!-- react-text: 306 -->
<!-- /react-text --><p class="lh-copy mv3" data-reactid="307"><!-- react-text: 308 -->No format lock in. When the wind blows a differnt direction and React falls out of favor, outputting to a different format will be easy.<!-- /react-text --></p><!-- react-text: 309 -->
<!-- /react-text --></li></ul></details><!-- react-text: 310 -->


<!-- /react-text --><h2 class="dark-gray f3" data-reactid="311"><!-- react-text: 312 -->Markdown ‚û°Ô∏è Webpack ‚û°Ô∏è Next.js<!-- /react-text --></h2><!-- react-text: 313 -->
<!-- /react-text --><p class="lh-copy mv3" data-reactid="314"><!-- react-text: 315 -->I wanted to write in Markdown and have Next.js pick up the changes automatically.<!-- /react-text --></p><!-- react-text: 316 -->
<!-- /react-text --><p class="lh-copy mv3" data-reactid="317"><!-- react-text: 318 -->By default, next will use any JavaScript modules that export a React component in your <!-- /react-text --><code class="f7 " data-reactid="319"><!-- react-text: 320 -->pages/<!-- /react-text --></code><!-- react-text: 321 --> directory. While writing markdown next to code is possible, it&#x27;s gross. Same goes for duplicating the same boilerplate file for each post and importing the markdown source from some other directory. I wanted to skip all that an go straight from Markdown into Next&#x27;s build and compile pipeline.<!-- /react-text --></p><!-- react-text: 322 -->
<!-- /react-text --><p class="lh-copy mv3" data-reactid="323"><!-- react-text: 324 -->üí° The lightbulb moment came when I realized the power of Next&#x27;s support for custom Webpack configuration.<!-- /react-text --></p><!-- react-text: 325 -->
<!-- /react-text --><p class="lh-copy mv3" data-reactid="326"><!-- react-text: 327 -->A  <!-- /react-text --><a href="https://webpack.js.org/concepts/loaders/" data-reactid="328"><!-- react-text: 329 -->webpack loader<!-- /react-text --></a><!-- react-text: 330 --> can transform markdown source files into modules on the spot! And better yet, I already had a build script from my prototype that was doing most of what I needed to do in the loader. I needed to change was how my build script found out about files (reading them from disk vs. passed in by webpack) and how it output the results (again, writing to disk vs. passing the result back to webpack). The loader plugin interface was dead simple:<!-- /react-text --></p><!-- react-text: 331 -->
<!-- /react-text --><pre class="f7 ba br1 b--black-90 pre-code overflow-x-scroll" data-reactid="332"><code class="f7  hljs language-js" data-reactid="333"><span class="hljs-built_in" data-reactid="334"><!-- react-text: 335 -->module<!-- /react-text --></span><!-- react-text: 336 -->.exports = <!-- /react-text --><span class="hljs-function" data-reactid="337"><span class="hljs-keyword" data-reactid="338"><!-- react-text: 339 -->function<!-- /react-text --></span><!-- react-text: 340 -->(<!-- /react-text --><span class="hljs-params" data-reactid="341"><!-- react-text: 342 -->source<!-- /react-text --></span><!-- react-text: 343 -->) <!-- /react-text --></span><!-- react-text: 344 -->{
  <!-- /react-text --><span class="hljs-keyword" data-reactid="345"><!-- react-text: 346 -->const<!-- /react-text --></span><!-- react-text: 347 --> done = <!-- /react-text --><span class="hljs-keyword" data-reactid="348"><!-- react-text: 349 -->this<!-- /react-text --></span><!-- react-text: 350 -->.async()

  renderPost(source, <!-- /react-text --><span class="hljs-keyword" data-reactid="351"><!-- react-text: 352 -->this<!-- /react-text --></span><!-- react-text: 353 -->.resourcePath)
    .catch(done).then(<!-- /react-text --><span class="hljs-function" data-reactid="354"><span class="hljs-params" data-reactid="355"><!-- react-text: 356 -->post<!-- /react-text --></span><!-- react-text: 357 --> =&gt;<!-- /react-text --></span><!-- react-text: 358 --> done(<!-- /react-text --><span class="hljs-literal" data-reactid="359"><!-- react-text: 360 -->null<!-- /react-text --></span><!-- react-text: 361 -->, post))
}<!-- /react-text --></code></pre><!-- react-text: 362 -->
<!-- /react-text --><p class="lh-copy mv3" data-reactid="363"><!-- react-text: 364 -->Where <!-- /react-text --><code class="f7 " data-reactid="365"><!-- react-text: 366 -->renderPost(source, resourcePath)<!-- /react-text --></code><!-- react-text: 367 --> was the middle bit of my prototyped static rendering pipeline, refactored to only need a string of the file content and the path of the file being rendered. This is one of the easiest changes to make, since it took a method formerly reliant on <!-- /react-text --><em data-reactid="368"><!-- react-text: 369 -->side effects<!-- /react-text --></em><!-- react-text: 370 -->, namely reading and writing to disk, and made it a pure function. Any time you can make a method that&#x27;s passed an input and return a result, you should. Decomposing your assumptions about side effects will almost always save time. I learned this from Gary Bernhardt&#x27;s talk <!-- /react-text --><em data-reactid="371"><a href="https://www.destroyallsoftware.com/talks/boundaries" data-reactid="372"><!-- react-text: 373 -->Boundaries<!-- /react-text --></a></em><!-- react-text: 374 -->, and I remember it every time I see it.<!-- /react-text --></p><!-- react-text: 375 -->
<!-- /react-text --><p class="lh-copy mv3" data-reactid="376"><!-- react-text: 377 -->The last step was to add it to the webpack extension point in <!-- /react-text --><code class="f7 " data-reactid="378"><!-- react-text: 379 -->next.config.js<!-- /react-text --></code><!-- react-text: 380 -->:<!-- /react-text --></p><!-- react-text: 381 -->
<!-- /react-text --><pre class="f7 ba br1 b--black-90 pre-code overflow-x-scroll" data-reactid="382"><code class="f7  hljs language-js" data-reactid="383"><span class="hljs-built_in" data-reactid="384"><!-- react-text: 385 -->module<!-- /react-text --></span><!-- react-text: 386 -->.exports = {
  webpack(config) {
    config.module.rules.push({
      <!-- /react-text --><span class="hljs-attr" data-reactid="387"><!-- react-text: 388 -->test<!-- /react-text --></span><!-- react-text: 389 -->: <!-- /react-text --><span class="hljs-regexp" data-reactid="390"><!-- react-text: 391 -->/\.html\.js$/<!-- /react-text --></span><!-- react-text: 392 -->,
      <!-- /react-text --><span class="hljs-attr" data-reactid="393"><!-- react-text: 394 -->include<!-- /react-text --></span><!-- react-text: 395 -->: <!-- /react-text --><span class="hljs-string" data-reactid="396"><!-- react-text: 397 -->&#x27;./pages/writing&#x27;<!-- /react-text --></span><!-- react-text: 398 -->,
      <!-- /react-text --><span class="hljs-attr" data-reactid="399"><!-- react-text: 400 -->loader<!-- /react-text --></span><!-- react-text: 401 -->: <!-- /react-text --><span class="hljs-string" data-reactid="402"><!-- react-text: 403 -->&#x27;./src/post-loader&#x27;<!-- /react-text --></span><!-- react-text: 404 -->
    })
    <!-- /react-text --><span class="hljs-keyword" data-reactid="405"><!-- react-text: 406 -->return<!-- /react-text --></span><!-- react-text: 407 --> config
  }
}<!-- /react-text --></code></pre><!-- react-text: 408 -->
<!-- /react-text --><h2 class="dark-gray f3" data-reactid="409"><!-- react-text: 410 -->Building and Deploying<!-- /react-text --></h2><!-- react-text: 411 -->
<!-- /react-text --><p class="lh-copy mv3" data-reactid="412"><!-- react-text: 413 -->Unlike in my earlier versions, Next.js 3 supports creating a complete static site from any next app with <!-- /react-text --><code class="f7 " data-reactid="414"><!-- react-text: 415 -->next export<!-- /react-text --></code><!-- react-text: 416 -->. To tell it what routes and pages to export, you need to add some configuration to <!-- /react-text --><code class="f7 " data-reactid="417"><!-- react-text: 418 -->next.config.js<!-- /react-text --></code><!-- react-text: 419 -->. Here&#x27;s what mine looks like:<!-- /react-text --></p><!-- react-text: 420 -->
<!-- /react-text --><pre class="f7 ba br1 b--black-90 pre-code overflow-x-scroll" data-reactid="421"><code class="f7  hljs language-js" data-reactid="422"><span class="hljs-built_in" data-reactid="423"><!-- react-text: 424 -->module<!-- /react-text --></span><!-- react-text: 425 -->.exports = {
  exportPathMap() {
    <!-- /react-text --><span class="hljs-keyword" data-reactid="426"><!-- react-text: 427 -->return<!-- /react-text --></span><!-- react-text: 428 --> {
      <!-- /react-text --><span class="hljs-string" data-reactid="429"><!-- react-text: 430 -->&quot;/&quot;<!-- /react-text --></span><!-- react-text: 431 -->: { <!-- /react-text --><span class="hljs-attr" data-reactid="432"><!-- react-text: 433 -->page<!-- /react-text --></span><!-- react-text: 434 -->: <!-- /react-text --><span class="hljs-string" data-reactid="435"><!-- react-text: 436 -->&quot;/&quot;<!-- /react-text --></span><!-- react-text: 437 --> },
      <!-- /react-text --><span class="hljs-string" data-reactid="438"><!-- react-text: 439 -->&quot;/cv.html&quot;<!-- /react-text --></span><!-- react-text: 440 -->: { <!-- /react-text --><span class="hljs-attr" data-reactid="441"><!-- react-text: 442 -->page<!-- /react-text --></span><!-- react-text: 443 -->: <!-- /react-text --><span class="hljs-string" data-reactid="444"><!-- react-text: 445 -->&quot;/cv.html&quot;<!-- /react-text --></span><!-- react-text: 446 --> },
      <!-- /react-text --><span class="hljs-string" data-reactid="447"><!-- react-text: 448 -->&quot;/writing/2016-reading-list.html&quot;<!-- /react-text --></span><!-- react-text: 449 -->: { <!-- /react-text --><span class="hljs-attr" data-reactid="450"><!-- react-text: 451 -->page<!-- /react-text --></span><!-- react-text: 452 -->: <!-- /react-text --><span class="hljs-string" data-reactid="453"><!-- react-text: 454 -->&quot;/writing/2016-reading-list.html&quot;<!-- /react-text --></span><!-- react-text: 455 --> },
      <!-- /react-text --><span class="hljs-string" data-reactid="456"><!-- react-text: 457 -->&quot;/writing/2017-reading-list.html&quot;<!-- /react-text --></span><!-- react-text: 458 -->: { <!-- /react-text --><span class="hljs-attr" data-reactid="459"><!-- react-text: 460 -->page<!-- /react-text --></span><!-- react-text: 461 -->: <!-- /react-text --><span class="hljs-string" data-reactid="462"><!-- react-text: 463 -->&quot;/writing/2017-reading-list.html&quot;<!-- /react-text --></span><!-- react-text: 464 --> },
      <!-- /react-text --><span class="hljs-comment" data-reactid="465"><!-- react-text: 466 -->// ...<!-- /react-text --></span><!-- react-text: 467 -->
    }
  }
}<!-- /react-text --></code></pre><!-- react-text: 468 -->
<!-- /react-text --><p class="lh-copy mv3" data-reactid="469"><!-- react-text: 470 -->Then I changed my build step to run <!-- /react-text --><code class="f7 " data-reactid="471"><!-- react-text: 472 -->next build &amp;&amp; next export --docs<!-- /react-text --></code><!-- react-text: 473 --> and I with surprisingly little drama was ready to deploy to Github pages!<!-- /react-text --></p><!-- react-text: 474 -->
<!-- /react-text --><p class="lh-copy mv3" data-reactid="475"><!-- react-text: 476 -->Normally I&#x27;d be worried that I&#x27;d have missed some minor detail in a major change like swapping out the entire backend of a website, but in essence what I was doing here wasn&#x27;t all that big of a change: my static HTML, JavaScript, and CSS in the <!-- /react-text --><code class="f7 " data-reactid="477"><!-- react-text: 478 -->docs/<!-- /react-text --></code><!-- react-text: 479 --> directory was still there, but was being built by a different tool chain. I pushed the first commit with the switch to Next.js and waited patiently while the build ran on Travis CI.<!-- /react-text --></p><!-- react-text: 480 -->
<!-- /react-text --><p class="lh-copy mv3" data-reactid="481"><!-- react-text: 482 -->...And that was it. I had more or less completely moved my static site into a totally modern React app with Next.js. The whole thing is <!-- /react-text --><a href="" data-reactid="483"><!-- react-text: 484 -->open source<!-- /react-text --></a><!-- react-text: 485 -->, so feel free to kick the tires and ask questions if you have any üòä<!-- /react-text --></p><!-- react-text: 486 -->
<!-- /react-text --><p class="lh-copy mv3" data-reactid="487"><!-- react-text: 488 -->Here are the relevant parts of the app:<!-- /react-text --></p><!-- react-text: 489 -->
<!-- /react-text --><ul data-reactid="490"><!-- react-text: 491 -->
<!-- /react-text --><li class="mv1 lh-copy" data-reactid="492"><strong data-reactid="493"><!-- react-text: 494 -->post-loader.js<!-- /react-text --></strong><!-- react-text: 495 --> ‚Äì <!-- /react-text --><a href="https://github.com/wookiehangover/wookiehangover.com/blob/master/src/post-loader.js" data-reactid="496"><!-- react-text: 497 -->webpack loader<!-- /react-text --></a></li><!-- react-text: 498 -->
<!-- /react-text --><li class="mv1 lh-copy" data-reactid="499"><strong data-reactid="500"><!-- react-text: 501 -->static-sites-with-next-js.html.js<!-- /react-text --></strong><!-- react-text: 502 --> ‚Äì <!-- /react-text --><a href="https://github.com/wookiehangover/wookiehangover.com/blob/master/pages/writing/static-sites-with-next-js.html.js" data-reactid="503"><!-- react-text: 504 -->a markdown post with embedded HTML<!-- /react-text --></a></li><!-- react-text: 505 -->
<!-- /react-text --><li class="mv1 lh-copy" data-reactid="506"><strong data-reactid="507"><!-- react-text: 508 -->react-to-hast.js<!-- /react-text --></strong><!-- react-text: 509 --> ‚Äì <!-- /react-text --><a href="https://github.com/wookiehangover/wookiehangover.com/blob/master/src/react-to-hast.js" data-reactid="510"><!-- react-text: 511 -->markdown compiler with Unified.js<!-- /react-text --></a></li><!-- react-text: 512 -->
<!-- /react-text --><li class="mv1 lh-copy" data-reactid="513"><strong data-reactid="514"><!-- react-text: 515 -->component-tree.js<!-- /react-text --></strong><!-- react-text: 516 --> ‚Äì <!-- /react-text --><a href="https://github.com/wookiehangover/wookiehangover.com/blob/master/src/components/component-tree.js" data-reactid="517"><!-- react-text: 518 -->React component for rendering JSON AST<!-- /react-text --></a></li><!-- react-text: 519 -->
<!-- /react-text --></ul><!-- react-text: 520 -->
<!-- /react-text --><h3 data-reactid="521"><!-- react-text: 522 -->Gotcha&#x27;s! üòù<!-- /react-text --></h3><!-- react-text: 523 -->
<!-- /react-text --><p class="lh-copy mv3" data-reactid="524"><!-- react-text: 525 -->A few snags I ran into:<!-- /react-text --></p><!-- react-text: 526 -->
<!-- /react-text --><ul data-reactid="527"><!-- react-text: 528 -->
<!-- /react-text --><li class="mv1 lh-copy" data-reactid="529"><!-- react-text: 530 -->
<!-- /react-text --><p class="lh-copy mv3" data-reactid="531"><!-- react-text: 532 -->Github pages still perversely retains some of it&#x27;s Jekyll roots, and ignores file and directory names that start with an underscore üôÑ<!-- /react-text --></p><!-- react-text: 533 -->
<!-- /react-text --><ul data-reactid="534"><!-- react-text: 535 -->
<!-- /react-text --><li class="mv1 lh-copy" data-reactid="536"><strong data-reactid="537"><!-- react-text: 538 -->Fix:<!-- /react-text --></strong><!-- react-text: 539 --> add <!-- /react-text --><code class="f7 " data-reactid="540"><!-- react-text: 541 -->.nojekyll<!-- /react-text --></code><!-- react-text: 542 --> to your <!-- /react-text --><code class="f7 " data-reactid="543"><!-- react-text: 544 -->docs/<!-- /react-text --></code><!-- react-text: 545 --> directory (or whatever is configured in the &quot;Pages&quot; portion of your repo config in Github)<!-- /react-text --></li><!-- react-text: 546 -->
<!-- /react-text --></ul><!-- react-text: 547 -->
<!-- /react-text --></li><!-- react-text: 548 -->
<!-- /react-text --><li class="mv1 lh-copy" data-reactid="549"><!-- react-text: 550 -->
<!-- /react-text --><p class="lh-copy mv3" data-reactid="551"><!-- react-text: 552 -->The <!-- /react-text --><code class="f7 " data-reactid="553"><!-- react-text: 554 -->.html.js<!-- /react-text --></code><!-- react-text: 555 --> file extension on the posts was because I wanted backwards compatabilty with my static html version, which used plain old html files<!-- /react-text --></p><!-- react-text: 556 -->
<!-- /react-text --><ul data-reactid="557"><!-- react-text: 558 -->
<!-- /react-text --><li class="mv1 lh-copy" data-reactid="559"><em data-reactid="560"><!-- react-text: 561 -->Minor annoyance:<!-- /react-text --></em><!-- react-text: 562 --> <!-- /react-text --><code class="f7 " data-reactid="563"><!-- react-text: 564 -->next export<!-- /react-text --></code><!-- react-text: 565 --> adds directories for every static file to avoid the .html extension showing up in the path, but now I have urls with trailing slashes.<!-- /react-text --></li><!-- react-text: 566 -->
<!-- /react-text --><li class="mv1 lh-copy" data-reactid="567"><!-- react-text: 568 -->If I ever want to change a URL (like to drop the <!-- /react-text --><code class="f7 " data-reactid="569"><!-- react-text: 570 -->.html<!-- /react-text --></code><!-- react-text: 571 --> extension because it&#x27;s not 1998), I&#x27;ll need to figure out how to manage the redirects.<!-- /react-text --></li><!-- react-text: 572 -->
<!-- /react-text --></ul><!-- react-text: 573 -->
<!-- /react-text --></li><!-- react-text: 574 -->
<!-- /react-text --><li class="mv1 lh-copy" data-reactid="575"><!-- react-text: 576 -->I need to remember to add new posts to <!-- /react-text --><code class="f7 " data-reactid="577"><!-- react-text: 578 -->next.config.js<!-- /react-text --></code><!-- react-text: 579 -->, which I seem pathologically incapable of. I&#x27;ll probably make the webpack plugin emit a JSON file with all the post metadata, but I haven&#x27;t done that yet.<!-- /react-text --></li><!-- react-text: 580 -->
<!-- /react-text --></ul><!-- react-text: 581 -->
<!-- /react-text --><p class="lh-copy mv3" data-reactid="582"><marquee data-reactid="583"><!-- react-text: 584 -->And here&#x27;s that <!-- /react-text --><code class="f7 " data-reactid="585"><!-- react-text: 586 -->&lt;marquee&gt;<!-- /react-text --></code><!-- react-text: 587 --> tag to prove I wasn&#x27;t joking about supporting arbitraty HTML in posts. And thanks <!-- /react-text --><a href="https://twitter.com/ddtrejo" data-reactid="588"><!-- react-text: 589 -->@ddtrejo<!-- /react-text --></a><!-- react-text: 590 --> for feedback and edits!<!-- /react-text --></marquee></p></div><footer class="mv2" data-reactid="591"><time data-reactid="592"><!-- react-text: 593 -->Last updated on <!-- /react-text --><small data-reactid="594"><code class="pa1 bg-near-white mid-gray" data-reactid="595">Wed Aug 16 23:47:50 2017 -0700</code></small></time><nav class="mv2 mv0-ns fr-ns" data-reactid="596"><a class="mr1" href="/{props.permalink}" data-reactid="597">Link</a><a class="mr1" href="https://github.com/wookiehangover/wookiehangover.com/edit/master/src/pages/writing/static-sites-with-next-js.html.js" data-reactid="598">Edit</a><a class="mr1" href="https://github.com/wookiehangover/wookiehangover.com/commits/master/src/pages/writing/static-sites-with-next-js.html.js" data-reactid="599">History</a></nav></footer></article></section></main><footer class="pv4 ph3 ph5-m ph6-l o-80 bt b--red bg-rainbows" data-reactid="600"><small class="f6 db tc" data-reactid="601"><i data-reactid="602"><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/" data-reactid="603">creative commons</a><!-- react-text: 604 --> √ó open source<!-- /react-text --></i><!-- react-text: 605 -->, so be kind rewind<!-- /react-text --></small><nav class="tc mt3" data-reactid="606"><div class="f6 dib mh2 pb2 pb0-ns link mid-gray" data-reactid="607"><span class="dib pr2 grow relative" data-reactid="608">üìñ </span><a href="https://twitter.com/sambreed" title="Follow me on Twitter" data-reactid="609">Sign my guestbook</a></div><div class="f6 dib mh2 pb2 pb0-ns link mid-gray" data-reactid="610"><span class="dib pr2 grow relative" data-reactid="611">üò° </span><a href="https://github.com/wookiehangover/wookiehangover.com/issues/new" title="Complaints" data-reactid="612">Complaints</a></div><div class="f6 dib mh2 pb2 pb0-ns link mid-gray" data-reactid="613"><span class="dib pr2 grow relative" data-reactid="614">üíÅüèª </span><a href="mailto:samuel.breed@gmail.com" title="Send me an Email" data-reactid="615">Suggestions</a></div></nav></footer></div></div></div><div id="__next-error"></div></div><div><script>
          __NEXT_DATA__ = {"props":{},"pathname":"/writing/static-sites-with-next-js.html","query":{},"buildId":"a31abcd8-316b-4d11-bde8-4d0933ce0896","buildStats":{"app.js":{"hash":"0099da6d259b9c7a1bd07664c3e5dd6e"}},"assetPrefix":"","nextExport":true,"err":null,"chunks":[]}
          module={}
          __NEXT_LOADED_PAGES__ = []
          __NEXT_LOADED_CHUNKS__ = []

          __NEXT_REGISTER_PAGE = function (route, fn) {
            __NEXT_LOADED_PAGES__.push({ route: route, fn: fn })
          }

          __NEXT_REGISTER_CHUNK = function (chunkName, fn) {
            __NEXT_LOADED_CHUNKS__.push({ chunkName: chunkName, fn: fn })
          }
        </script><script async="" id="__NEXT_PAGE__/writing/static-sites-with-next-js.html" type="text/javascript" src="/_next/a31abcd8-316b-4d11-bde8-4d0933ce0896/page/writing/static-sites-with-next-js.html/index.js"></script><script async="" id="__NEXT_PAGE__/_error" type="text/javascript" src="/_next/a31abcd8-316b-4d11-bde8-4d0933ce0896/page/_error/index.js"></script><div></div><script type="text/javascript" src="/_next/0099da6d259b9c7a1bd07664c3e5dd6e/app.js" async=""></script></div></body></html>